<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Lista de Presentes - Casamento</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#fff8f8;margin:0;padding:0;color:#333;}
header{background:linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)),url('https://images.unsplash.com/photo-1529634899792-3ae3f219b5e4?auto=format&fit=crop&w=1500&q=80') no-repeat center/cover;color:white;padding:80px 20px;text-align:center;}
header h1{font-size:42px;margin-bottom:8px;}
header p{font-size:18px;}
#lista,#painelNoiva{max-width:1000px;margin:32px auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;padding:0 12px;}
.presente{background:white;border-radius:12px;padding:18px;box-shadow:0 4px 10px rgba(0,0,0,0.08);text-align:center;transition:transform 0.2s;}
.presente:hover{transform:scale(1.02);}
.presente h3{margin:8px 0;font-size:20px;color:#b82e5f;}
.presente p{margin:4px 0;font-weight:bold;}
.presente a{display:inline-block;margin:8px 0;color:#b82e5f;text-decoration:none;font-weight:bold;word-break:break-word;}
input,.senha{margin:8px 0;padding:10px;border-radius:8px;border:1px solid #ccc;width:100%;box-sizing:border-box;}
button{background:#b82e5f;color:white;border:none;padding:10px 16px;border-radius:8px;cursor:pointer;font-size:15px;margin-top:6px;}
button:hover{background:#9c234d;}
#loginNoiva{text-align:center;padding:20px;background:#fff0f5;margin:24px auto;max-width:420px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08);}
.muted{color:#777;font-weight:normal;font-size:14px;}
footer{text-align:center;padding:18px;background:#fff0f5;color:#444;margin-top:24px;}
</style>
</head>
<body>
<header>
<h1>üíç Nossa Lista de Casamento</h1>
<p>Estamos muito felizes em compartilhar esse momento especial com voc√™!</p>
</header>

<main>
<section id="lista"></section>

<section id="loginNoiva">
<h2>üîí Acesso da Noiva</h2>
<input type="password" id="senhaNoiva" class="senha" placeholder="Digite a senha">
<button id="btnLogin">Entrar</button>
<p class="muted">Ap√≥s entrar, voc√™ ver√° todos os presentes (incluindo os j√° escolhidos).</p>
</section>

<section id="painelNoiva" style="display:none;"></section>
</main>

<footer>
<p>Obrigado pelo carinho e por fazer parte da nossa hist√≥ria! üíñ</p>
</footer>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwekLcUpGGEQvzjmaA_YGRpJJ6_S6SbHfw_-kPcW9YiGb86jAwtJoFnlegYMFTXGcB_4Q/exec"; // substitua pelo URL do seu Web App
const SENHA_NOIVA = "meuacesso123";

function makeSafeId(txt){return'nome_'+String(txt).normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^\w\-]+/g,'_');}

async function carregarPresentes(){
    try{
        const res=await fetch(API_URL);
        if(!res.ok)throw new Error('Falha ao carregar presentes');
        const data=await res.json();

        const lista=document.getElementById("lista");
        lista.innerHTML="";
        data.filter(p=>(p.status||'').toLowerCase()==="dispon√≠vel").forEach(p=>{
            const inputId=makeSafeId(p.item);
            const div=document.createElement("div");
            div.className="presente";
            div.innerHTML=`
            <h3>${p.item}</h3>
            <p>Valor: R$ ${p.valor||"-"}</p>
            <a href="${p.link}" target="_blank">Ver na loja</a><br>
            <input type="text" id="${inputId}" placeholder="Seu nome">
            <button data-item="${encodeURIComponent(p.item)}" class="btnEscolher">Escolher presente</button>`;
            lista.appendChild(div);
        });

        const painel=document.getElementById("painelNoiva");
        painel.innerHTML="";
        data.forEach(p=>{
            const div=document.createElement("div");
            div.className="presente";
            div.innerHTML=`
            <h3>${p.item}</h3>
            <p>Valor: R$ ${p.valor||"-"}</p>
            <p>Status: ${p.status||"-"}</p>
            <p>Quem escolheu: ${p.quem||"-"}</p>
            <a href="${p.link}" target="_blank">Ver na loja</a>`;
            painel.appendChild(div);
        });

        document.querySelectorAll('.btnEscolher').forEach(btn=>{
            btn.addEventListener('click',async ev=>{
                const itemOriginal=decodeURIComponent(ev.currentTarget.getAttribute('data-item'));
                const inputId=makeSafeId(itemOriginal);
                const nome=document.getElementById(inputId)?.value?.trim();
                if(!nome){alert("Por favor, digite seu nome."); return;}
                ev.currentTarget.disabled=true;
                ev.currentTarget.textContent='Enviando...';
                try{
                    const resp=await fetch(API_URL,{
                        method:"POST",
                        headers:{"Content-Type":"application/json"},
                        body:JSON.stringify({item:itemOriginal,quem:nome})
                    });
                    if(!resp.ok)throw new Error('Falha no POST');
                    const result=await resp.json();
                    if(result.success) alert(`Obrigado, ${nome}! Voc√™ escolheu: ${itemOriginal}`);
                    else alert(result.message||"N√£o foi poss√≠vel reservar o presente.");
                    await carregarPresentes();
                }catch(err){console.error(err); alert("Erro ao reservar. Tente novamente.");}
                finally{ev.currentTarget.disabled=false; ev.currentTarget.textContent='Escolher presente';}
            });
        });

    }catch(err){console.error(err);alert("N√£o foi poss√≠vel carregar a lista agora.");}
}

function entrarNoiva(){
    const senha=document.getElementById("senhaNoiva").value;
    if(senha===SENHA_NOIVA){
        document.getElementById("loginNoiva").style.display="none";
        document.getElementById("painelNoiva").style.display="grid";
    }else{alert("Senha incorreta!");}
}

document.getElementById('btnLogin').addEventListener('click',entrarNoiva);

carregarPresentes();
</script>
</body>
</html>
